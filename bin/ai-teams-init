#!/bin/bash
#
# ai-teams-init - Initialize AI teams structure in a project
#
# Usage: ai-teams-init [project-name]
#
# Creates .epistemic/ directory with supervisor state, worker directory,
# and decisions log. Prints instructions for getting started.

set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
TEMPLATE_DIR="$SCRIPT_DIR/../templates/ai-teams"

PROJECT_NAME="${1:-$(basename "$(pwd)")}"

# Check if already initialized
if [ -d ".epistemic" ]; then
    echo "Error: .epistemic/ already exists in this directory"
    exit 1
fi

# Create structure
echo "Creating .epistemic/ structure..."
mkdir -p .epistemic/workers

# Copy templates
cp "$TEMPLATE_DIR/supervisor.md" .epistemic/supervisor.md
cp "$TEMPLATE_DIR/decisions.log" .epistemic/decisions.log
cp "$TEMPLATE_DIR/worker-task.md" .epistemic/workers/TEMPLATE.md

# Update supervisor.md with project name
sed -i "s/\[Project Name\]/$PROJECT_NAME/" .epistemic/supervisor.md

echo ""
echo "AI Teams initialized for: $PROJECT_NAME"
echo ""
echo "Structure created:"
echo "  .epistemic/"
echo "  ├── supervisor.md      # Your state file - edit Terminal Goal"
echo "  ├── decisions.log      # Append decisions here"
echo "  └── workers/"
echo "      └── TEMPLATE.md    # Copy this for new worker tasks"
echo ""
echo "Next steps:"
echo "  1. Edit .epistemic/supervisor.md - set your Terminal Goal"
echo "  2. Read claude_tools/ai-teams-supervisor.md for role instructions"
echo "  3. Create your first worker task by copying TEMPLATE.md"
echo ""
echo "Permission note:"
echo "  AI teams uses pty-session which may require permissions."
echo "  Use temp.sh pattern to batch pty-session commands."
echo "  See supervisor prompt for details."
echo ""
